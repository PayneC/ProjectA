local Vector3 = CS.UnityEngine.Vector3
-- User: ct
-- Date: 2017-10-31 14:56
-- Description: AIController
local _M = class()

function _M:ctor()
    -- 数据
    self.UID = 0 --动态ID
    self.data = false --动态ID关联的数据引用 数据来自数据管理类
    
    --组件
    self.gameObject = false
    self.characterController = false
    self.navMeshAgent = false
    
    self.controller = false
    
    -- TEMP 以下数据均存在于data下
    self.pos = Vector3.zero
    self.dir = 0
    
    self.stateID = false
    self.nextStateID = false
    
    self.state = false
    self.stateMap = false
end

function _M:GetStateID()
    return self.stateID
end

function _M:SetController(_script)
    local _stateMap = require(_script)
    self.stateMap = _stateMap
end

function _M:SetUID()
end

function _M:SetPos()
end

function _M:SetDir()
end

function _M:SetDID()
end

function _M:Update(dt)
    if self.nextStateID then
        if self.state and self.state.Exit then
            self.state.Exit(self)
        end
        
        self.stateID = self.nextStateID
        self.state = self.stateMap[self.stateID]
        
        if self.state and self.state.Enter then
            self.state.Enter(self)
        end
        
        self.nextState = false
    end
    
    if self.state and self.state.Check then
        self.nextStateID = self.state.Check(self)
    end
end

function _M:OnDestroy()
    self.state = false
    self.nextState = false
end

return _M
