local lvmgr = require('base/lv_mgr')
local uiconfig = require('configs/cf_ui')
local uimgr = require('base/ui_mgr')

local asset = require('base/asset')

local mainCamera = require('entity/camera/maincamera')
local Vector3 = CS.UnityEngine.Vector3

local npc = require('entity/actor/npc')

local debug = require('base/debug')
local input = require('base/input')

local _M = class()

function _M:OnEnter(_config, _parameter)
    lvmgr.SetLoading(1, 0.2, false)
    
    uimgr.SetDefaultUI(uiconfig.main)
    uimgr.OpenCommonUI(uiconfig.input)
    
    local function callback(assetEntity)
        assetEntity:GetInstantiate()
        local _npcs = _config.npcs
        for i = 1, #_npcs, 1 do
            local _cf = _npcs[i]
            local _npc = npc.new()
            _npc:SetUID(i)
            _npc:SetPos(_cf[2], _cf[3], _cf[4])
            _npc:SetDir(_cf[5])
            _npc:SetDID(_cf[1])
        end
        
        lvmgr.SetLoading(1, 1, true)
        
        local function joy(x, y, s)
            debug.LogFormat(0, '%f, %f, %f', x, y, s)
        end
        input.AddJoystick(joy)
    end
    
    --mainCamera.SetPosition(Vector3(0, 15, 0))
    --mainCamera.LookAt(Vector3.zero)
    asset.AsyncLoad(asset.EAssetType.SCENE, _config.terrain, callback)
end

function _M:OnExit()

end

return _M
